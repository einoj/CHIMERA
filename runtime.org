* main

* read_byte_arr commit 35bf0cdbc03121731398042e5e9190730852defe
| x OPCODE  |                cycles | Total cycles | Comment                                      |
|-----------+-----------------------+--------------+----------------------------------------------|
| 8 push    |                     2 |           16 |                                              |
| 2 rcall   |                     2 |            6 |                                              |
| 1 push    |                     2 |            2 |                                              |
| 2 in      |                     1 |            2 |                                              |
| 2 movw    |                     1 |            2 |                                              |
| 1 cp      |                     1 |            1 |                                              |
| 1 cpc     |                     1 |            1 |                                              |
| 1 ldi     |                     1 |            1 |                                              |
| 2 cpc     |                     1 |            2 |                                              |
| 1 brcs    |                     2 |            2 | Skips the jump                               |
| 1 movw    |                     1 |            1 |                                              |
| 1 adiw    |                     2 |            1 |                                              |
| 4 std+4   |                     2 |            8 |                                              |
| 1 call    |                 4+159 |          163 | calls read_status_reg                        |
| 4 ldd Y+q |                     3 |           12 |                                              |
| 1 cpi     |                     1 |            1 | checks if read_status_reg return value is 1  |
| 1 brne    |                     1 |            1 | Usualy condition is false, only uses 1 cycle |
| 1 ldd Y+1 |                     3 |            3 |                                              |
| 1 sbrc    |                     2 |            2 | usually skips, 2 cycles, else 1              |
| 1 in      |                     1 |            1 | DISABLE_SPI_INTERRUPT                        |
| 1 andi    |                     1 |            1 |                                              |
| 1 out     |                     1 |            1 | SELEC_SERIAL_MEMORY                          |
| 1 cbi     |                     2 |            2 |                                              |
| 1 ldi     |                     1 |            1 |                                              |
| 4 std Y+q |                     2 |            8 |                                              |
| 1 call    |                  4+59 |           63 | Send READ command                            |
| 1 mov     |                     1 |            1 |                                              |
| 1 call    |                  4+59 |           63 | Transfer MSB of address                      |
| 1 mov     |                     1 |            1 |                                              |
| 1 call    |                  4+59 |           63 | Transfer Middle byte of addres               |
| 1 mov     |                     1 |            1 |                                              |
| 1 call    |                  4+59 |           63 | Transfer LSB byte of address                 |
| 1 mov     |                     1 |            1 |                                              |
| 1 movw    |                     1 |            1 |                                              |
| 4 ldd Y+q |                     3 |           12 |                                              |
| 1 mov     |                     1 |              | Enter loop                                   |
| 1 sub     |                     1 |              |                                              |
| 3 ldi     |                     1 |              |                                              |
| 1 cp      |                     1 |              |                                              |
| 3 cpc     |                     1 |              |                                              |
| 1 brcc    | 1 if false, 2 if true |              |                                              |
| 1 ldi     |                     1 |              |                                              |
| 4 std Y+q |                     2 |              |                                              |
| 1 call    |                  4+59 |              |                                              |
| 1 movw    |                     1 |              |                                              |
| 1 st z+   |                     1 |              |                                              |
| 1 movw    |                     1 |              |                                              |
| 4 ldd Y+q |                     3 |              |                                              |
| rjmp      |                     2 |              | one loop takes 99 cycles                     |
|           |              99*256+1 |        25345 | We ususally transfer one page, 256 bytes,    |
|           |                       |              | the aditional cycle is from brcc being true  |
| 1 sbi     |                     2 |            2 |                                              |
| 1 in      |                     1 |            1 |                                              |
| 1 ori     |                     1 |            1 |                                              |
| 1 out     |                     1 |            1 |                                              |
| 1 ldi     |                     1 |            1 |                                              |
| 1 rjmp    |                     2 |            2 |                                              |
| 13 pop    |                     2 |           26 |                                              |
| 1 ret     |                     4 |            4 |                                              |
| TOTAL     |                       |        25893 |                                              |

* read_status_reg commit 35bf0cdbc03121731398042e5e9190730852defe
| x OPCODE | cycles | Total cycles | Comment                  |
|----------+--------+--------------+--------------------------|
| 2 push   |      2 |            4 |                          |
| 1 lds    |      2 |            2 |                          |
| 1 cpse   |      2 |            2 |                          |
| 1 movw   |      1 |            1 |                          |
| 1 in     |      1 |            1 |                          |
| 1 andi   |      1 |            1 |                          |
| 1 out    |      1 |            1 |                          |
| 1 cbi    |      1 |            1 |                          |
| 1 ldi    |      1 |            1 |                          |
| 1 call   |   4+59 |           63 | calls spi_tx_byte        |
| 1 ldi    |      1 |            1 |                          |
| 1 call   |   4+59 |           63 | calls spi_tx_byte        |
| 1 st Y   |      2 |            2 |                          |
| 1 sbi    |      2 |            2 |                          |
| 1 in     |      1 |            1 |                          |
| 1 ori    |      1 |            1 |                          |
| 1 out    |      1 |            1 |                          |
| 1 ldi    |      1 |            1 |                          |
| 1 rjmp   |      2 |            2 |                          |
| 2 pop    |      2 |            4 |                          |
| 1 ret    |      4 |            4 | returns to read_byte_arr |
| TOTAL    |        |          159 |                          |


* spi_tx_byte commit 35bf0cdbc03121731398042e5e9190730852defe
| # OPCODE       |               cycles | Total cycles | Comment                                  |
|----------------+----------------------+--------------+------------------------------------------|
| 3 push         |                    2 |            6 |                                          |
| 2 in           |                    1 |            2 |                                          |
| 1 std Y+1      |                    2 |            2 |                                          |
| 1 ldd Y+1      |                    2 |            2 |                                          |
| 1 out          |                    1 |            1 |                                          |
| 1 in  r0, 0x2d |                    1 |              | start of loop, loads SPSR (0x2d) into R0 |
| 1 sbrs r0, 7   | 1 if false 2 if true |              | skips next instruction if bit 7 is set   |
| 1 rjmp         |                    2 |              | Bit 7 in SPSR will be set once the spi   |
|                |                      |           35 | transfer is done. 8 bits is transfered   |
| 1 in           |                    1 |            1 | at a time, at fosc/4. Thus is takes      |
| 3 pop          |                    2 |            6 | 8*4 = 32 cycles to make a transfer.      |
| 1 ret          |                    4 |            4 | Each run of the loop takes 4 cycles,     |
| TOTAL          |                      |           59 | Thus it needs to loop 8 times, then an   |
|                |                      |              | additional loop which takes 3 cycles     |
|                |                      |              | because of true test spending a total of |
|                |                      |              | 35 mcu cycles.                           |
|                |                      |              |                                          |
|                |                      |              |                                          |
